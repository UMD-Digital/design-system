<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Usage Guide - UMD Design System Documentation</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css"
      rel="stylesheet"
    />
    <style>
      .header {
        background-color: #e21833;
        color: white;
        padding: 2rem 0;
      }
      .nav-link {
        color: #000;
      }
      .nav-link:hover {
        color: #e21833;
      }
      pre {
        background-color: #f8f9fa;
        border-radius: 4px;
        padding: 1rem;
        overflow-x: auto;
      }
      code {
        color: #e83e8c;
      }
      .toc {
        position: sticky;
        top: 20px;
      }
      .toc-link {
        display: block;
        padding: 0.25rem 0;
        color: #666;
        text-decoration: none;
      }
      .toc-link:hover {
        color: #e21833;
      }
      .toc-link.active {
        color: #e21833;
        font-weight: 500;
      }
    </style>
</head>
<body>
    <header class="header">
      <div class="container">
        <h1>Advanced Usage Guide</h1>
        <p class="lead">UMD Web Components - Type System, Testing, and Advanced Patterns</p>
      </div>
    </header>

    <div class="container py-5">
      <div class="row">
        <div class="col-md-3">
          <nav class="toc">
            <h5 class="mb-3">Table of Contents</h5>
            <a href="#type-system" class="toc-link">Type System</a>
            <a href="#reactive-components" class="toc-link">Reactive Components</a>
            <a href="#testing-components" class="toc-link">Testing Components</a>
            <a href="#custom-component-development" class="toc-link">Custom Component Development</a>
            <a href="#performance-optimization" class="toc-link">Performance Optimization</a>
            <a href="#advanced-patterns" class="toc-link">Advanced Patterns</a>
          </nav>
        </div>
        
        <div class="col-md-9">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="../index.html">Home</a></li>
              <li class="breadcrumb-item"><a href="index.html">Components</a></li>
              <li class="breadcrumb-item active" aria-current="page">Advanced Usage Guide</li>
            </ol>
          </nav>

          <p class="lead">This guide covers advanced topics for developers working with the UMD Web Components Library, including the type system, testing strategies, reactive components, and custom component development.</p>

          <!-- Type System Section -->
          <div class="card mb-4" id="type-system">
            <div class="card-header">
              <h2 class="h4 mb-0">Type System</h2>
            </div>
            <div class="card-body">
              <p>The library is built with TypeScript and provides comprehensive type definitions for type-safe development.</p>
              
              <h3 class="h5">Core Types</h3>
              <pre><code class="language-typescript">import type {
  ComponentRef,
  CreateComponentFunction,
  ComponentRegistration,
  SlotConfiguration,
  ThemeProps,
  VisualStateProps,
  ComponentEvents,
} from '@universityofmaryland/web-components-library';</code></pre>

              <h4 class="h6 mt-4">ComponentRef</h4>
              <p>The base reference returned by all component factories:</p>
              <pre><code class="language-typescript">interface ComponentRef {
  element: HTMLElement | DocumentFragment;
  styles: string;
  events?: {
    load?: () => void;
    resize?: () => void;
    destroy?: () => void;
  };
}</code></pre>

              <h4 class="h6 mt-4">SlotConfiguration</h4>
              <p>Defines validation rules for component slots:</p>
              <pre><code class="language-typescript">interface SlotConfig {
  allowedElements: string[];
  required?: boolean;
  deprecated?: {
    replacement: string;
    version?: string;
  };
}

interface SlotConfiguration {
  [slotName: string]: SlotConfig;
}

// Example usage
const slots: SlotConfiguration = {
  headline: {
    allowedElements: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'],
    required: true,
  },
  text: {
    allowedElements: ['p', 'div'],
    required: false,
  },
};</code></pre>

              <h4 class="h6 mt-4">Component Properties</h4>
              <p>Common property interfaces for consistent component behavior:</p>
              <pre><code class="language-typescript">interface ThemeProps {
  isThemeDark?: boolean;
  isThemeLight?: boolean;
}

interface VisualStateProps {
  isVisualOpen?: boolean;
  isAnimated?: boolean;
}

interface LayoutProps {
  displayType?: 'grid' | 'list' | 'inline';
  columns?: number;
  gap?: 'small' | 'medium' | 'large';
}</code></pre>

              <h3 class="h5 mt-4">Type-Safe Component Usage</h3>
              <pre><code class="language-typescript">// Import specific component types
import type { CardComponent } from '@universityofmaryland/web-components-library';

// Type-safe element references
const card = document.querySelector&lt;CardComponent&gt;('umd-element-card');

if (card) {
  // TypeScript knows the available attributes and methods
  card.setAttribute('data-theme', 'dark');
  card.addEventListener('component:ready', (e) => {
    console.log('Card initialized');
  });
}</code></pre>
            </div>
          </div>

          <!-- Reactive Components Section -->
          <div class="card mb-4" id="reactive-components">
            <div class="card-header">
              <h2 class="h4 mb-0">Reactive Components</h2>
            </div>
            <div class="card-body">
              <p>Components can react to attribute changes and update their content dynamically.</p>
              
              <h3 class="h5">Observed Attributes</h3>
              <p>Components observe specific attributes and react to changes:</p>
              <pre><code class="language-javascript">// HTML
&lt;umd-element-accordion-item id="myAccordion"&gt;
  &lt;h3 slot="headline"&gt;Dynamic Content&lt;/h3&gt;
  &lt;div slot="text"&gt;Content here&lt;/div&gt;
&lt;/umd-element-accordion-item&gt;

// JavaScript
const accordion = document.getElementById('myAccordion');

// Programmatically open the accordion
accordion.setAttribute('is-visual-open', 'true');

// Trigger a resize calculation
accordion.setAttribute('resize', 'true');

// Close with animation
accordion.setAttribute('is-visual-closed', 'true');</code></pre>

              <h3 class="h5 mt-4">Attribute Handlers</h3>
              <p>The library provides pre-configured attribute handlers for common behaviors:</p>
              <pre><code class="language-javascript">import { Attributes } from 'model';

// Resize handler - triggers when 'resize' attribute changes
const resizeHandler = Attributes.handler.common.resize((element) => {
  console.log('Component resized');
  element.events?.recalculate();
});

// Visual toggle handler - manages open/close states
const toggleHandler = Attributes.handler.common.visualToggle({
  onOpen: (element) => console.log('Opened'),
  onClose: (element) => console.log('Closed'),
});

// Combine multiple handlers
const combinedHandler = Attributes.handler.combine([
  resizeHandler,
  toggleHandler,
]);</code></pre>

              <h3 class="h5 mt-4">Creating Reactive Components</h3>
              <pre><code class="language-javascript">import { Register, Attributes } from 'model';

export default Register.webComponent({
  tagName: 'umd-reactive-example',
  slots: slotConfig,
  createComponent: componentFactory,
  attributes: [
    // Observe 'data-count' attribute changes
    {
      name: 'data-count',
      callback: (element, oldValue, newValue) => {
        const component = element.shadowRoot.querySelector('.counter');
        if (component) {
          component.textContent = newValue;
        }
      },
    },
    // Use pre-built handlers
    Attributes.handler.common.resize(),
  ],
});</code></pre>

              <h3 class="h5 mt-4">Component Events</h3>
              <p>Components dispatch custom events for state changes:</p>
              <pre><code class="language-javascript">// Listen for component lifecycle events
const element = document.querySelector('umd-element-card');

element.addEventListener('component:ready', (e) => {
  console.log('Component initialized and ready');
});

element.addEventListener('component:update', (e) => {
  console.log('Component updated:', e.detail);
});

element.addEventListener('component:destroy', (e) => {
  console.log('Component destroyed');
});

// Visual state events
element.addEventListener('visual:open', (e) => {
  console.log('Component opened');
});

element.addEventListener('visual:close', (e) => {
  console.log('Component closed');
});</code></pre>
            </div>
          </div>

          <!-- Testing Components Section -->
          <div class="card mb-4" id="testing-components">
            <div class="card-header">
              <h2 class="h4 mb-0">Testing Components</h2>
            </div>
            <div class="card-body">
              <p>The library uses Jest with jsdom for comprehensive component testing.</p>
              
              <h3 class="h5">Test Setup</h3>
              <pre><code class="language-javascript">import { jest } from '@jest/globals';
import '../../../__mocks__/webComponentsLibrary.js';

// Component-specific imports
import Component from '../component-name';

describe('Component: umd-element-example', () => {
  const tagName = 'umd-element-example';

  beforeEach(() => {
    jest.clearAllMocks();
  });

  afterEach(() => {
    // Clean up DOM
    document.body.innerHTML = '';
  });
});</code></pre>

              <h3 class="h5 mt-4">Testing Component Registration</h3>
              <pre><code class="language-javascript">it('should register the web component', () => {
  const registerSpy = jest.spyOn(customElements, 'define');
  
  Component();
  
  expect(registerSpy).toHaveBeenCalledWith(
    tagName,
    expect.any(Function)
  );
});</code></pre>

              <h3 class="h5 mt-4">Testing Slot Validation</h3>
              <pre><code class="language-javascript">it('should validate required slots', () => {
  Component();
  
  const element = document.createElement(tagName);
  // Missing required headline slot
  document.body.appendChild(element);
  
  expect(console.error).toHaveBeenCalledWith(
    expect.stringContaining('required slot')
  );
});

it('should accept valid slot elements', () => {
  Component();
  
  const element = document.createElement(tagName);
  element.innerHTML = `
    &lt;h3 slot="headline"&gt;Valid Headline&lt;/h3&gt;
    &lt;p slot="text"&gt;Valid text content&lt;/p&gt;
  `;
  
  document.body.appendChild(element);
  
  expect(console.error).not.toHaveBeenCalled();
});</code></pre>

              <h3 class="h5 mt-4">Testing Reactive Attributes</h3>
              <pre><code class="language-javascript">it('should respond to attribute changes', async () => {
  Component();
  
  const element = document.createElement(tagName);
  document.body.appendChild(element);
  
  // Change observed attribute
  element.setAttribute('resize', 'true');
  
  // Wait for async update
  await new Promise(resolve => setTimeout(resolve, 0));
  
  // Verify component updated
  const shadowContent = element.shadowRoot.querySelector('.component');
  expect(shadowContent).toHaveClass('resized');
});</code></pre>

              <h3 class="h5 mt-4">Testing Events</h3>
              <pre><code class="language-javascript">it('should dispatch component events', async () => {
  Component();
  
  const element = document.createElement(tagName);
  const readySpy = jest.fn();
  
  element.addEventListener('component:ready', readySpy);
  document.body.appendChild(element);
  
  // Wait for component initialization
  await new Promise(resolve => setTimeout(resolve, 100));
  
  expect(readySpy).toHaveBeenCalled();
});</code></pre>

              <h3 class="h5 mt-4">Testing Deprecations</h3>
              <pre><code class="language-javascript">it('should warn about deprecated attributes', () => {
  Component();
  
  const warnSpy = jest.spyOn(console, 'warn');
  const element = document.createElement(tagName);
  
  // Use deprecated attribute
  element.setAttribute('theme', 'dark');
  document.body.appendChild(element);
  
  expect(warnSpy).toHaveBeenCalledWith(
    expect.stringContaining('deprecated'),
    expect.stringContaining('data-theme')
  );
});</code></pre>
            </div>
          </div>

          <!-- Custom Component Development Section -->
          <div class="card mb-4" id="custom-component-development">
            <div class="card-header">
              <h2 class="h4 mb-0">Custom Component Development</h2>
            </div>
            <div class="card-body">
              <h3 class="h5">Component Structure</h3>
              <pre><code class="language-typescript">import { Composite } from '@universityofmaryland/web-elements-library';
import { Attributes, Slots, Register, Lifecycle } from 'model';
import type {
  CreateComponentFunction,
  ComponentRegistration,
  SlotConfiguration,
} from '../_types';

/**
 * Tag name for the custom component
 */
const tagName = 'umd-custom-widget';

/**
 * Slot configuration with validation rules
 */
const slots: SlotConfiguration = {
  headline: {
    allowedElements: ['h2', 'h3', 'h4'],
    required: true,
  },
  content: {
    allowedElements: ['div', 'section'],
    required: false,
  },
  actions: {
    allowedElements: ['div', 'nav'],
    required: false,
  },
};

/**
 * Component factory function
 */
const createComponent: CreateComponentFunction = (element) => {
  // Extract and validate slot content
  const headline = Slots.headline.default({ element });
  const content = Slots.query.element({ element, name: 'content' });
  const actions = Slots.query.elements({ element, name: 'actions' });
  
  // Extract configuration attributes
  const theme = Attributes.isTheme.dark({ element }) ? 'dark' : 'light';
  const size = element.getAttribute('data-size') || 'medium';
  
  // Create component structure
  return Composite.customWidget.create({
    headline,
    content,
    actions,
    theme,
    size,
    events: {
      load: () => {
        element.dispatchEvent(new CustomEvent('component:ready'));
      },
      resize: () => {
        // Handle resize logic
      },
      destroy: () => {
        // Cleanup logic
      },
    },
  });
};

/**
 * Custom Widget Component
 * 
 * @example
 * ```html
 * &lt;umd-custom-widget data-theme="dark" data-size="large"&gt;
 *   &lt;h3 slot="headline"&gt;Widget Title&lt;/h3&gt;
 *   &lt;div slot="content"&gt;Widget content&lt;/div&gt;
 *   &lt;div slot="actions"&gt;
 *     &lt;button&gt;Action&lt;/button&gt;
 *   &lt;/div&gt;
 * &lt;/umd-custom-widget&gt;
 * ```
 */
export default Register.webComponent({
  tagName,
  slots,
  createComponent,
  attributes: [
    Attributes.handler.common.resize(),
    Attributes.handler.common.visualToggle(),
  ],
  afterConnect: Lifecycle.hooks.loadOnConnect,
});</code></pre>

              <h3 class="h5 mt-4">Complex Components with Models</h3>
              <p>For components with shared logic across variants:</p>
              <pre><code class="language-typescript">// _model.ts
import type { CreateComponentFunction } from '../_types';

export interface WidgetConfig {
  variant: 'standard' | 'compact' | 'expanded';
  theme?: 'light' | 'dark';
}

export const createWidgetFactory = (
  config: WidgetConfig
): CreateComponentFunction => {
  return (element) => {
    // Shared logic for all widget variants
    const baseConfig = extractBaseConfig(element);
    
    switch (config.variant) {
      case 'compact':
        return createCompactWidget(baseConfig);
      case 'expanded':
        return createExpandedWidget(baseConfig);
      default:
        return createStandardWidget(baseConfig);
    }
  };
};

// standard.ts
import { Register } from 'model';
import { createWidgetFactory } from './_model';

export default Register.webComponent({
  tagName: 'umd-widget-standard',
  slots,
  createComponent: createWidgetFactory({ variant: 'standard' }),
});</code></pre>
            </div>
          </div>

          <!-- Performance Optimization Section -->
          <div class="card mb-4" id="performance-optimization">
            <div class="card-header">
              <h2 class="h4 mb-0">Performance Optimization</h2>
            </div>
            <div class="card-body">
              <h3 class="h5">Lazy Loading Components</h3>
              <p>Load components only when needed:</p>
              <pre><code class="language-javascript">// Dynamic import on user interaction
button.addEventListener('click', async () => {
  const { modal } = await import(
    '@universityofmaryland/web-components-library/Components'
  );
  
  modal.standard();
  
  // Now create and show the modal
  const modalElement = document.createElement('umd-element-modal');
  document.body.appendChild(modalElement);
});</code></pre>

              <h3 class="h5 mt-4">Intersection Observer for Lazy Initialization</h3>
              <pre><code class="language-javascript">// Lazy initialize components when they become visible
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      const element = entry.target;
      element.setAttribute('load', 'true');
      observer.unobserve(element);
    }
  });
});

// Observe all components
document.querySelectorAll('umd-element-card').forEach(card => {
  observer.observe(card);
});</code></pre>

              <h3 class="h5 mt-4">Component Pooling</h3>
              <p>Reuse component instances for better performance:</p>
              <pre><code class="language-javascript">class ComponentPool {
  constructor(tagName, maxSize = 10) {
    this.tagName = tagName;
    this.pool = [];
    this.maxSize = maxSize;
  }
  
  acquire() {
    if (this.pool.length > 0) {
      return this.pool.pop();
    }
    return document.createElement(this.tagName);
  }
  
  release(component) {
    if (this.pool.length < this.maxSize) {
      // Reset component state
      component.innerHTML = '';
      component.removeAttribute('data-state');
      this.pool.push(component);
    }
  }
}

const cardPool = new ComponentPool('umd-element-card');</code></pre>
            </div>
          </div>

          <!-- Advanced Patterns Section -->
          <div class="card mb-4" id="advanced-patterns">
            <div class="card-header">
              <h2 class="h4 mb-0">Advanced Patterns</h2>
            </div>
            <div class="card-body">
              <h3 class="h5">Component Composition</h3>
              <p>Create higher-level components by composing existing ones:</p>
              <pre><code class="language-javascript">class UmdDashboard extends HTMLElement {
  connectedCallback() {
    this.attachShadow({ mode: 'open' });
    
    this.shadowRoot.innerHTML = `
      &lt;style&gt;
        :host {
          display: grid;
          grid-template-columns: 1fr 3fr;
          gap: 2rem;
        }
      &lt;/style&gt;
      
      &lt;aside&gt;
        &lt;umd-element-navigation-drawer&gt;
          &lt;slot name="navigation"&gt;&lt;/slot&gt;
        &lt;/umd-element-navigation-drawer&gt;
      &lt;/aside&gt;
      
      &lt;main&gt;
        &lt;umd-element-text-container&gt;
          &lt;slot name="header"&gt;&lt;/slot&gt;
        &lt;/umd-element-text-container&gt;
        
        &lt;div class="content"&gt;
          &lt;slot&gt;&lt;/slot&gt;
        &lt;/div&gt;
      &lt;/main&gt;
    `;
  }
}

customElements.define('umd-dashboard', UmdDashboard);</code></pre>

              <h3 class="h5 mt-4">State Management Integration</h3>
              <p>Integrate with state management libraries:</p>
              <pre><code class="language-javascript">// Redux integration example
import { store } from './store';
import { updateComponent } from './actions';

class StateConnectedComponent extends HTMLElement {
  connectedCallback() {
    this.unsubscribe = store.subscribe(() => {
      this.updateFromState();
    });
    
    this.updateFromState();
  }
  
  disconnectedCallback() {
    if (this.unsubscribe) {
      this.unsubscribe();
    }
  }
  
  updateFromState() {
    const state = store.getState();
    
    // Update component attributes based on state
    this.setAttribute('data-theme', state.theme);
    this.setAttribute('data-count', state.count.toString());
  }
}</code></pre>

              <h3 class="h5 mt-4">Custom Attribute Handlers</h3>
              <p>Create specialized attribute handlers:</p>
              <pre><code class="language-javascript">const createCounterHandler = (step = 1) => ({
  name: 'data-counter',
  callback: (element, oldValue, newValue) => {
    const current = parseInt(newValue) || 0;
    const display = element.shadowRoot.querySelector('.counter-display');
    
    if (display) {
      // Animate counter change
      const start = parseInt(oldValue) || 0;
      const duration = 300;
      const startTime = performance.now();
      
      const animate = (currentTime) => {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const value = Math.floor(start + (current - start) * progress);
        
        display.textContent = value.toString();
        
        if (progress < 1) {
          requestAnimationFrame(animate);
        }
      };
      
      requestAnimationFrame(animate);
    }
  },
});</code></pre>

              <h3 class="h5 mt-4">Shadow DOM Styling Strategies</h3>
              <p>Advanced styling techniques for Shadow DOM:</p>
              <pre><code class="language-javascript">const createComponent = (element) => {
  // Allow external styling through CSS custom properties
  const styles = `
    :host {
      --component-bg: var(--umd-component-bg, #fff);
      --component-color: var(--umd-component-color, #333);
      
      background: var(--component-bg);
      color: var(--component-color);
    }
    
    /* Slotted content styling */
    ::slotted(h3) {
      margin: 0 0 1rem;
      color: inherit;
    }
    
    /* Part-based styling API */
    .header {
      part: header;
    }
    
    /* Theme variations */
    :host([data-theme="dark"]) {
      --component-bg: #333;
      --component-color: #fff;
    }
  `;
  
  return {
    element: componentElement,
    styles,
  };
};</code></pre>
            </div>
          </div>

          <div class="card mb-4">
            <div class="card-body">
              <h2 class="h4">Additional Resources</h2>
              <ul class="list-unstyled">
                <li><a href="https://www.typescriptlang.org/">TypeScript Documentation</a></li>
                <li><a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components">Web Components MDN Guide</a></li>
                <li><a href="https://jestjs.io/">Jest Testing Documentation</a></li>
                <li><a href="https://github.com/umd-digital/design-system">UMD Design System Repository</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="bg-light py-4 mt-5">
      <div class="container">
        <div class="row">
          <div class="col-md-12 text-center">
            <p>&copy; University of Maryland. All rights reserved.</p>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script>
      // Smooth scrolling for TOC links
      document.querySelectorAll('.toc-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const target = document.querySelector(link.getAttribute('href'));
          if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      });

      // Update active TOC link on scroll
      const observerOptions = {
        rootMargin: '-100px 0px -70% 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            document.querySelectorAll('.toc-link').forEach(link => {
              link.classList.remove('active');
            });
            const activeLink = document.querySelector(`.toc-link[href="#${entry.target.id}"]`);
            if (activeLink) {
              activeLink.classList.add('active');
            }
          }
        });
      }, observerOptions);

      document.querySelectorAll('[id]').forEach(section => {
        observer.observe(section);
      });
    </script>
</body>
</html>